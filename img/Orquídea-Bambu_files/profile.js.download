(function(){
    var elements = {};

    jQuery(document).ready(function() {
        setCookie();
    });

    function getStoreID() {
        return document.querySelector('html').getAttribute('data-store') ||
            getCurrentScript().getAttribute('data-store');
    }

    function getCurrentScript() {
        if (!elements.currentScript) {
            elements.currentScript = document.getElementById('pageview-script');
        }

        return elements.currentScript;
    }

    function setCookie() {
        jQuery.ajax({
            type: 'GET',
            url: '/nocache/app.php?loja=' + getStoreID(),
            success: function(returnData) {
                jQuery.ajax({
                    type: 'GET',
                    url: '/nocache/profile.php?loja=' + getStoreID() + '&url=' + encodeURIComponent(document.location.href) + '&session_id=' + returnData.hash + '&hash=' + Date.now(),
                    success: function(returnData) {
                        if (!returnData || returnData.status != 'sucess') {
                            return;
                        }
                    },
                    dataType: 'json'
                });
            },
            dataType: 'json'
        });
    }
})();
